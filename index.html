<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Document</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.3/xlsx.full.min.js"></script>
</head>

<body>
  <input type="file" id="fileUpload" accept=".xls,.xlsx,.csv" /><br />
  <button type="button" id="uploadExcel">Convert</button>
  <!-- <pre id="jsonData"></pre> -->

  <pre id="groupedDataString"></pre>

</body>
<script>
  var selectedFile;
  document
    .getElementById("fileUpload")
    .addEventListener("change", function (event) {
      selectedFile = event.target.files[0];
    });

  document
    .getElementById("uploadExcel")
    .addEventListener("click", function () {
      if (selectedFile) {
        console.log("hi");
        var fileReader = new FileReader();
        fileReader.onload = function (event) {
          var data = event.target.result;

          var workbook = XLSX.read(data, {
            type: "binary",
          });

          workbook.SheetNames.forEach((sheet) => {
            let rowObject = XLSX.utils.sheet_to_row_object_array(
              workbook.Sheets[sheet]
            );

            // Grouping by "Taxable Value"
            const groupedData = groupByTaxAmount(rowObject);
            console.log(groupedData);

            var tax5;
            var tax0;
            var tax12;
            var tax15;
            var tax18;

            // Calculating Total "Amount of Tax" for each "Taxable Value"
            for (const key in groupedData) {
              const totalAmountOfTax = groupedData[key].reduce((total, obj) => total + obj["__EMPTY_8"], 0);
              if (key == "0") {
                tax0 = totalAmountOfTax
              } else if (key == "5") {
                tax5 = totalAmountOfTax
              } else if (key == "12") {
                tax12 = totalAmountOfTax
              } else if (key == "15") {
                tax15 = totalAmountOfTax
              } else if (key == "18") {
                tax18 = totalAmountOfTax
              }

              let total = tax0 + tax5 + tax12 + tax15 + tax18
              let result = `0% = ${tax0} \n 5% = ${tax5}  \n 12% = ${tax0}  \n 15% = ${tax12}  \n 18% = ${tax15}  \n Total = ${total}  `

              document.getElementById("groupedDataString").innerHTML = result;

              console.log(`Taxable Value: ${key}, Total Amount of Tax: ${totalAmountOfTax}`);
            }

          });

        };
        fileReader.readAsBinaryString(selectedFile);
      }
    });


  function groupByTaxAmount(data) {
      const groups = {};
      for (const item of data) {
        const taxAmount = parseFloat(item["__EMPTY_7"] || 0); // Ensure numerical value (default to 0)
        if (taxAmount !== undefined && taxAmount !== 0) {
          const formattedTaxAmount = taxAmount.toFixed(2); // Format to 2 decimal places
          if (!groups[formattedTaxAmount]) {
            groups[formattedTaxAmount] = [];
          }
          groups[formattedTaxAmount].push(item);
        }
      }
      return groups;
    }

</script>

</html>